# Story 5.2: Daily Area Summary Card

## Status
Ready for Development

> **‚ö†Ô∏è IMPLEMENTATION NOTE:** Use SIMPLE approach from Story 4.1:
> - Query `deep_work_log.area` directly (NOT deep_work_sessions with business_id joins)
> - Use simple string-based areas: 'Full Stack', 'S4', '808', 'Personal', 'Huge Capital', 'Golf', 'Health'
> - No business_id or life_area_id foreign keys - just area TEXT column
> - All SQL functions should query `deep_work_log` table directly
> - For "Daily" area filtering, use WHERE area = 'Personal' (maps to Daily tasks)
>
> **üìã SEE:** [`STORY_CORRECTIONS_SUMMARY.md`](../../STORY_CORRECTIONS_SUMMARY.md) for complete transformation guide

## Story
**As someone** planning execution each day,
**I want** the Daily area card to show today's critical information,
**so that** I can immediately see what needs to be accomplished today without opening Daily page.

## Acceptance Criteria
1. Daily card displays:
   - Tasks due today count (e.g., "8 tasks due today")
   - Daily completion % (tasks completed / total tasks for today)
   - Deep Work hours logged today vs. daily target (e.g., "2h / 6h target")
   - Next scheduled item from today's Schedule (e.g., "Next: Client call at 2pm")
2. Visual progress ring or bar showing daily completion %
3. Color coding: green if on track (>50% complete by current time of day), yellow if behind, red if falling significantly behind
4. "Due Tomorrow" preview: count of tasks due tomorrow for planning awareness
5. Overdue tasks indicator: if any overdue tasks exist, prominent red badge with count
6. Quick action: "Plan Today" button navigates directly to Daily To-Do List page
7. Daily card shows most recent Deep Work session: "Last session: 2h on Huge Capital (30 min ago)"

## Tasks / Subtasks
- [ ] Task 1: Create enhanced Daily area aggregation query (AC: 1, 4, 5)
  - [ ] Create src/hooks/useDailyAreaSummary.ts hook
  - [ ] Query tasks due today: WHERE due_date = CURRENT_DATE
  - [ ] Calculate today's completion: COUNT(progress = 100) / COUNT(*) √ó 100
  - [ ] Query overdue tasks: WHERE due_date < CURRENT_DATE AND progress < 100
  - [ ] Query tasks due tomorrow: WHERE due_date = CURRENT_DATE + 1
  - [ ] Query deep_work_log for today's logged hours (WHERE DATE(start_time) = CURRENT_DATE AND end_time IS NOT NULL)
  - [ ] Calculate daily target from user preferences or default 6h
  - [ ] Query next scheduled item from schedule table ordered by time
  - [ ] Optimize with single query using CTEs (Common Table Expressions)

- [ ] Task 2: Build adaptive time-of-day progress tracking (AC: 3)
  - [ ] Create src/utils/dailyProgressCalculator.ts utility
  - [ ] Calculate expected progress by time of day:
    - 9am: 0% expected (day just started)
    - 12pm: 25% expected (morning complete)
    - 3pm: 50% expected (afternoon midpoint)
    - 6pm: 75% expected (near end of work day)
    - 9pm: 100% expected (day ending)
  - [ ] Compare actual completion % vs expected %
  - [ ] Color coding logic:
    - Green: actual >= expected (on track or ahead)
    - Yellow: actual >= expected - 20% (slightly behind)
    - Red: actual < expected - 20% (significantly behind)
  - [ ] Handle edge cases: tasks added late in day don't penalize progress
  - [ ] Account for weekends vs weekdays (different expected curves)

- [ ] Task 3: Create DailyAreaCard enhanced component (AC: 1, 2, 3, 6)
  - [ ] Create src/components/review/DailyAreaCard.tsx
  - [ ] Extend ReviewAreaCard with daily-specific enhancements
  - [ ] Display tasks due today count: "8 tasks due today" prominently
  - [ ] Show circular progress ring (not bar) for daily completion %
  - [ ] Apply adaptive color coding: green/yellow/red based on time-of-day expectations
  - [ ] Add "Plan Today" button with Calendar icon in card footer
  - [ ] Include mini-timeline showing morning/afternoon/evening segments
  - [ ] Display current time marker on timeline
  - [ ] Use Recharts RadialBarChart for circular progress visualization
  - [ ] Add subtle pulse animation if falling behind (red state)

- [ ] Task 4: Implement Deep Work session display (AC: 1, 7)
  - [ ] Query most recent deep_work_log WHERE start_time >= TODAY AND end_time IS NOT NULL
  - [ ] Calculate session duration: end_time - start_time in hours (or use duration_minutes field)
  - [ ] Display format: "Last session: 2.5h on Full Stack (30 min ago)"
  - [ ] Show area color-coded chip for visual association
  - [ ] If no sessions today: show "No deep work logged today ‚ö†Ô∏è"
  - [ ] Link to Deep Work timer: click session ‚Üí open timer modal
  - [ ] Display total vs target: "2.5h / 6h target (42%)"
  - [ ] Add progress bar showing daily Deep Work target progress
  - [ ] Highlight if target achieved: "‚úÖ Daily target reached!"

- [ ] Task 5: Build "Due Tomorrow" preview section (AC: 4)
  - [ ] Query tasks WHERE due_date = CURRENT_DATE + 1
  - [ ] Display count: "5 tasks due tomorrow"
  - [ ] Show as collapsible section: click to expand preview list
  - [ ] Preview shows top 3 tasks due tomorrow with names
  - [ ] Color code by priority: high priority tasks in red
  - [ ] Add "View Tomorrow" link navigating to Daily page with tomorrow filter
  - [ ] Display warning if >10 tasks due tomorrow: "Heavy load tomorrow ‚ö†Ô∏è"
  - [ ] Show estimated total hours for tomorrow's tasks

- [ ] Task 6: Implement overdue tasks indicator (AC: 5)
  - [ ] Query overdue: WHERE due_date < CURRENT_DATE AND progress < 100
  - [ ] Display prominent red badge: "3 overdue" in top-right corner of card
  - [ ] Add pulsing red dot animation to draw attention
  - [ ] Click badge ‚Üí navigate to Daily page filtered to overdue tasks
  - [ ] Show oldest overdue task: "Client deliverable - 5 days overdue"
  - [ ] Calculate total overdue days across all tasks
  - [ ] Display urgency level: <3 days = warning, >7 days = critical
  - [ ] Include overdue count in card priority calculation

- [ ] Task 7: Create next scheduled item widget (AC: 1)
  - [ ] Query schedule/calendar table for today's events ordered by time
  - [ ] Filter to future events: WHERE event_time > NOW()
  - [ ] Display format: "Next: Client call at 2:00 PM (in 45 minutes)"
  - [ ] Show event type icon: video call, meeting, focus block, etc.
  - [ ] Add countdown timer updating every minute
  - [ ] Color code urgency: <15 min = red, 15-60 min = yellow, >60 min = gray
  - [ ] If no more events today: "No scheduled events remaining"
  - [ ] Link to full schedule view on Daily page

- [ ] Task 8: Build circular progress ring visualization (AC: 2)
  - [ ] Use Recharts RadialBarChart component
  - [ ] Create src/components/shared/CircularProgress.tsx
  - [ ] Display completion % in center of ring with large font
  - [ ] Ring colors: green (on track), yellow (behind), red (significantly behind)
  - [ ] Add gradient effect on ring stroke
  - [ ] Animate ring fill from 0% to actual % on mount
  - [ ] Show target line as subtle mark on ring (e.g., where you should be)
  - [ ] Responsive sizing: 120px on mobile, 150px on desktop
  - [ ] Add accessibility: aria-label with completion percentage

- [ ] Task 9: Implement "Plan Today" quick action button (AC: 6)
  - [ ] Add button in card footer: "Plan Today" with Calendar icon
  - [ ] Navigate to /daily route with today's date pre-selected
  - [ ] Button prominence: primary color, larger than standard links
  - [ ] Show keyboard shortcut hint: "Press P"
  - [ ] Add hover tooltip: "Open Daily To-Do List"
  - [ ] Track analytics: log button clicks for feature usage metrics
  - [ ] Disable button if already on Daily page (prevent redundant navigation)
  - [ ] Alternative action: if no tasks today, show "Create Task" instead

- [ ] Task 10: Integrate real-time updates for Daily card (AC: 7)
  - [ ] Subscribe to tasks table changes WHERE due_date = TODAY
  - [ ] Subscribe to deep_work_log changes WHERE start_time >= TODAY
  - [ ] Update completion % immediately when task marked complete
  - [ ] Update Deep Work hours when session logged or updated
  - [ ] Recalculate color coding when progress changes
  - [ ] Update "last session" timestamp every minute
  - [ ] Invalidate query cache on task creation/deletion
  - [ ] Optimistic updates: increment counters before DB confirmation
  - [ ] Test: mark task complete ‚Üí verify Daily card updates <500ms

## Dev Notes

### Previous Story Insights

**From Story 5.1:** [Source: docs/stories/5.1.review-dashboard-page-structure.md]
- ReviewAreaCard base component established with icon, progress, navigation
- useReviewDashboard hook for system-wide aggregation
- Priority sorting and visual hierarchy patterns
- READ-ONLY enforcement mechanisms
- Responsive grid layout with 7 areas

**From Epic 2 Stories:** [Source: docs/stories/2.1-2.6]
- Story 2.5 covers Daily Goals Progress Tracking (foundational)
- progress_percentage calculation on tasks
- ProgressBar component with variants
- Daily completion % formula: completed / total √ó 100

**From Epic 4 Stories:** [Source: docs/stories/4.1-4.6]
- Story 4.1: deep_work_log table with area TEXT column (simple approach)
- Daily time allocation: SUM(duration_minutes) WHERE start_time >= TODAY AND end_time IS NOT NULL
- Deep Work target tracking (default 6h per day)
- Direct area-based queries (no business_id joins)

**From Epic 1 Stories:** [Source: docs/stories/1.1-1.6]
- tasks table with due_date, progress_percentage, area fields
- useRealtimeSync for live updates
- Optimistic update patterns

**Key Technical Context:**
- Daily card is MOST CRITICAL for morning routine: users check this first
- Time-of-day adaptive progress is unique to Daily (not other areas)
- Deep Work integration makes Daily card cross-Epic (combines tasks + time)
- Overdue tasks are highest priority signal: must be visually prominent
- "Due Tomorrow" preview helps evening planning workflow

### Architecture Context

**Tech Stack:** [Source: docs/ui-architecture/2-frontend-tech-stack.md]
- React 19.1.1 + TypeScript 5.9.3
- TanStack Query 5.90.2 for state management
- Recharts for RadialBarChart circular progress
- date-fns 4.1.0 for time calculations and formatting
- Lucide React 0.544.0 for icons

**Database Query: Daily Area Summary**
```sql
-- Comprehensive daily aggregation with schedule and Deep Work
CREATE OR REPLACE FUNCTION get_daily_area_summary(p_user_id UUID)
RETURNS TABLE (
  tasks_due_today INTEGER,
  completed_today INTEGER,
  completion_percentage NUMERIC,
  overdue_count INTEGER,
  oldest_overdue_days INTEGER,
  tasks_due_tomorrow INTEGER,
  deep_work_hours_today NUMERIC,
  deep_work_target_hours NUMERIC,
  last_session_business TEXT,
  last_session_duration NUMERIC,
  last_session_time TIMESTAMPTZ,
  next_event_title TEXT,
  next_event_time TIMESTAMPTZ
) AS $$
BEGIN
  RETURN QUERY
  WITH today_tasks AS (
    SELECT
      COUNT(*) FILTER (WHERE t.due_date = CURRENT_DATE) as due_today,
      COUNT(*) FILTER (WHERE t.due_date = CURRENT_DATE AND t.progress_percentage = 100) as completed,
      COUNT(*) FILTER (WHERE t.due_date < CURRENT_DATE AND t.progress_percentage < 100) as overdue,
      MAX(EXTRACT(DAY FROM (CURRENT_DATE - t.due_date))) FILTER (WHERE t.due_date < CURRENT_DATE AND t.progress_percentage < 100) as oldest_overdue,
      COUNT(*) FILTER (WHERE t.due_date = CURRENT_DATE + 1) as due_tomorrow
    FROM tasks t
    WHERE t.user_id = p_user_id AND t.area = 'DAILY'
  ),
  deep_work_today AS (
    SELECT
      COALESCE(SUM(dwl.duration_minutes) / 60.0, 0) as hours_today,
      dwl.area as area_name,
      dwl.duration_minutes / 60.0 as session_duration,
      dwl.end_time as session_time,
      ROW_NUMBER() OVER (ORDER BY dwl.end_time DESC) as rn
    FROM deep_work_log dwl
    WHERE dwl.user_id = p_user_id
      AND DATE(dwl.start_time) = CURRENT_DATE
      AND dwl.end_time IS NOT NULL
  ),
  next_scheduled AS (
    SELECT
      s.title as event_title,
      s.start_time as event_time
    FROM schedule s
    WHERE s.user_id = p_user_id
      AND DATE(s.start_time) = CURRENT_DATE
      AND s.start_time > NOW()
    ORDER BY s.start_time
    LIMIT 1
  )
  SELECT
    tt.due_today::INTEGER,
    tt.completed::INTEGER,
    CASE
      WHEN tt.due_today > 0 THEN ROUND((tt.completed::NUMERIC / tt.due_today) * 100, 1)
      ELSE 0
    END as completion_percentage,
    tt.overdue::INTEGER,
    tt.oldest_overdue::INTEGER,
    tt.due_tomorrow::INTEGER,
    (SELECT SUM(hours_today) FROM deep_work_today)::NUMERIC,
    6.0::NUMERIC as target_hours, -- Could be from user_preferences table
    (SELECT area_name FROM deep_work_today WHERE rn = 1),
    (SELECT session_duration FROM deep_work_today WHERE rn = 1),
    (SELECT session_time FROM deep_work_today WHERE rn = 1),
    ns.event_title,
    ns.event_time
  FROM today_tasks tt
  CROSS JOIN LATERAL (SELECT * FROM next_scheduled) ns;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

**React Hook: useDailyAreaSummary**
```typescript
// src/hooks/useDailyAreaSummary.ts
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/lib/supabase';
import { formatDistanceToNow, format } from 'date-fns';

export interface DailyAreaSummary {
  tasksDueToday: number;
  completedToday: number;
  completionPercentage: number;
  overdueCount: number;
  oldestOverdueDays: number;
  tasksDueTomorrow: number;
  deepWorkHoursToday: number;
  deepWorkTargetHours: number;
  deepWorkProgress: number;
  lastSessionBusiness: string | null;
  lastSessionDuration: number | null;
  lastSessionTime: Date | null;
  lastSessionFormatted: string;
  nextEventTitle: string | null;
  nextEventTime: Date | null;
  nextEventFormatted: string;
  progressStatus: 'ahead' | 'on-track' | 'behind' | 'critical';
  progressColor: 'green' | 'yellow' | 'red';
}

export const useDailyAreaSummary = () => {
  return useQuery({
    queryKey: ['daily', 'area-summary'],
    queryFn: async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) throw new Error('Not authenticated');

      const { data, error } = await supabase.rpc('get_daily_area_summary', {
        p_user_id: user.id,
      });

      if (error) throw error;

      const summary = data[0];

      // Calculate time-of-day expected progress
      const currentHour = new Date().getHours();
      const expectedProgress = calculateExpectedProgress(currentHour);
      const actualProgress = summary.completion_percentage;
      const progressDiff = actualProgress - expectedProgress;

      // Determine progress status
      let progressStatus: 'ahead' | 'on-track' | 'behind' | 'critical';
      let progressColor: 'green' | 'yellow' | 'red';

      if (progressDiff >= 10) {
        progressStatus = 'ahead';
        progressColor = 'green';
      } else if (progressDiff >= -10) {
        progressStatus = 'on-track';
        progressColor = 'green';
      } else if (progressDiff >= -25) {
        progressStatus = 'behind';
        progressColor = 'yellow';
      } else {
        progressStatus = 'critical';
        progressColor = 'red';
      }

      return {
        tasksDueToday: summary.tasks_due_today,
        completedToday: summary.completed_today,
        completionPercentage: summary.completion_percentage,
        overdueCount: summary.overdue_count,
        oldestOverdueDays: summary.oldest_overdue_days,
        tasksDueTomorrow: summary.tasks_due_tomorrow,
        deepWorkHoursToday: summary.deep_work_hours_today,
        deepWorkTargetHours: summary.deep_work_target_hours,
        deepWorkProgress: (summary.deep_work_hours_today / summary.deep_work_target_hours) * 100,
        lastSessionBusiness: summary.last_session_business,
        lastSessionDuration: summary.last_session_duration,
        lastSessionTime: summary.last_session_time ? new Date(summary.last_session_time) : null,
        lastSessionFormatted: summary.last_session_time
          ? formatDistanceToNow(new Date(summary.last_session_time), { addSuffix: true })
          : 'No sessions today',
        nextEventTitle: summary.next_event_title,
        nextEventTime: summary.next_event_time ? new Date(summary.next_event_time) : null,
        nextEventFormatted: summary.next_event_time
          ? `${summary.next_event_title} at ${format(new Date(summary.next_event_time), 'h:mm a')}`
          : 'No events scheduled',
        progressStatus,
        progressColor,
      } as DailyAreaSummary;
    },
    staleTime: 30000, // 30 seconds (more frequent than general review)
    refetchInterval: 60000, // Auto-refetch every minute
  });
};

// Calculate expected progress based on time of day
function calculateExpectedProgress(hour: number): number {
  // Work day curve: 9am-6pm
  if (hour < 9) return 0;
  if (hour >= 18) return 100;

  // Linear progression 9am-6pm
  const workHours = hour - 9;
  return (workHours / 9) * 100;
}
```

**DailyAreaCard Component:**
```typescript
// src/components/review/DailyAreaCard.tsx
import { FC } from 'react';
import { useNavigate } from 'react-router-dom';
import { Calendar, AlertCircle, Clock, ChevronRight } from 'lucide-react';
import { useDailyAreaSummary } from '@/hooks/useDailyAreaSummary';
import { CircularProgress } from '@/components/shared/CircularProgress';

export const DailyAreaCard: FC = () => {
  const navigate = useNavigate();
  const { data: summary, isLoading } = useDailyAreaSummary();

  if (isLoading || !summary) return <DailyAreaCardSkeleton />;

  const borderColor = {
    green: 'border-green-500',
    yellow: 'border-yellow-500',
    red: 'border-red-500',
  }[summary.progressColor];

  return (
    <div
      className={`bg-gray-800 rounded-lg p-6 border-2 ${borderColor}
                  hover:border-blue-500 transition-all duration-300 cursor-pointer
                  transform hover:scale-105 hover:shadow-xl
                  ${summary.progressColor === 'red' ? 'animate-pulse-subtle' : ''}`}
      onClick={() => navigate('/daily')}
    >
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-3">
          <Calendar className="text-blue-500" size={32} />
          <div>
            <h3 className="text-xl font-bold text-white">DAILY</h3>
            <p className="text-sm text-gray-400">
              {summary.tasksDueToday} tasks due today
            </p>
          </div>
        </div>
        {summary.overdueCount > 0 && (
          <div className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse">
            {summary.overdueCount} overdue
          </div>
        )}
      </div>

      {/* Circular Progress */}
      <div className="flex items-center justify-center mb-6">
        <CircularProgress
          progress={summary.completionPercentage}
          color={summary.progressColor}
          size={140}
          label={`${summary.completedToday}/${summary.tasksDueToday}`}
        />
      </div>

      {/* Progress Status */}
      <div className={`text-center mb-4 p-2 rounded bg-${summary.progressColor}-950/30`}>
        <p className={`text-sm font-semibold text-${summary.progressColor}-300`}>
          {summary.progressStatus === 'ahead' && 'üöÄ Ahead of schedule'}
          {summary.progressStatus === 'on-track' && '‚úÖ On track'}
          {summary.progressStatus === 'behind' && '‚ö†Ô∏è Falling behind'}
          {summary.progressStatus === 'critical' && 'üî¥ Significantly behind'}
        </p>
      </div>

      {/* Deep Work Section */}
      <div className="mb-4 p-3 bg-gray-900 rounded border border-gray-700">
        <div className="flex items-center justify-between mb-2">
          <span className="text-xs text-gray-500 uppercase">Deep Work Today</span>
          <span className="text-sm font-semibold text-white">
            {summary.deepWorkHoursToday.toFixed(1)}h / {summary.deepWorkTargetHours}h
          </span>
        </div>
        <div className="w-full bg-gray-700 rounded-full h-2">
          <div
            className={`h-2 rounded-full transition-all ${
              summary.deepWorkProgress >= 100 ? 'bg-green-500' : 'bg-blue-500'
            }`}
            style={{ width: `${Math.min(summary.deepWorkProgress, 100)}%` }}
          />
        </div>
        {summary.lastSessionBusiness && (
          <p className="text-xs text-gray-400 mt-2">
            Last: {summary.lastSessionDuration?.toFixed(1)}h on {summary.lastSessionBusiness}{' '}
            ({summary.lastSessionFormatted})
          </p>
        )}
      </div>

      {/* Next Event */}
      {summary.nextEventTime && (
        <div className="mb-4 flex items-center gap-2 p-2 bg-blue-950/30 border border-blue-500 rounded">
          <Clock size={16} className="text-blue-400" />
          <p className="text-sm text-blue-200">Next: {summary.nextEventFormatted}</p>
        </div>
      )}

      {/* Due Tomorrow */}
      {summary.tasksDueTomorrow > 0 && (
        <div className="mb-4 p-2 bg-purple-950/30 border border-purple-500 rounded">
          <p className="text-sm text-purple-200">
            {summary.tasksDueTomorrow} tasks due tomorrow
            {summary.tasksDueTomorrow > 10 && ' ‚ö†Ô∏è'}
          </p>
        </div>
      )}

      {/* Footer Actions */}
      <div className="flex items-center justify-between border-t border-gray-700 pt-3">
        <button
          className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg
                     font-semibold transition-colors flex items-center gap-2"
          onClick={(e) => {
            e.stopPropagation();
            navigate('/daily');
          }}
        >
          <Calendar size={16} />
          Plan Today
        </button>
        <div className="flex items-center text-gray-400 hover:text-white transition-colors">
          <span className="text-sm">View Details</span>
          <ChevronRight size={16} className="ml-1" />
        </div>
      </div>
    </div>
  );
};
```

**Circular Progress Component:**
```typescript
// src/components/shared/CircularProgress.tsx
import { FC } from 'react';
import { RadialBarChart, RadialBar, PolarAngleAxis } from 'recharts';

interface CircularProgressProps {
  progress: number;
  color: 'green' | 'yellow' | 'red';
  size?: number;
  label?: string;
}

export const CircularProgress: FC<CircularProgressProps> = ({
  progress,
  color,
  size = 140,
  label,
}) => {
  const data = [{ value: progress, fill: getColorHex(color) }];

  return (
    <div className="relative" style={{ width: size, height: size }}>
      <RadialBarChart
        width={size}
        height={size}
        cx={size / 2}
        cy={size / 2}
        innerRadius={size * 0.35}
        outerRadius={size * 0.45}
        barSize={12}
        data={data}
        startAngle={90}
        endAngle={-270}
      >
        <PolarAngleAxis
          type="number"
          domain={[0, 100]}
          angleAxisId={0}
          tick={false}
        />
        <RadialBar
          background
          dataKey="value"
          cornerRadius={10}
          fill={getColorHex(color)}
        />
      </RadialBarChart>
      <div className="absolute inset-0 flex flex-col items-center justify-center">
        <span className="text-3xl font-bold text-white">{progress.toFixed(0)}%</span>
        {label && <span className="text-xs text-gray-400 mt-1">{label}</span>}
      </div>
    </div>
  );
};

function getColorHex(color: 'green' | 'yellow' | 'red'): string {
  return {
    green: '#10b981',
    yellow: '#f59e0b',
    red: '#ef4444',
  }[color];
}
```

**File Locations:**
- Create: supabase/migrations/create-daily-area-summary-function.sql
- Create: src/hooks/useDailyAreaSummary.ts
- Create: src/components/review/DailyAreaCard.tsx
- Create: src/components/shared/CircularProgress.tsx
- Create: src/utils/dailyProgressCalculator.ts
- Update: src/pages/ReviewDashboard.tsx (integrate DailyAreaCard)
- Reuse: src/hooks/useRealtimeSync.ts (from Epic 1)

### Testing

**Testing Requirements:** [Source: docs/prd/technical-assumptions.md]
Manual testing with systematic verification

**Daily Area Card Testing Workflow:**
1. **Tasks Due Today Accuracy:**
   - Create 5 tasks with due_date = TODAY
   - Verify card shows "5 tasks due today"
   - Complete 2 tasks ‚Üí verify shows "2/5 complete (40%)"
   - Create task due yesterday ‚Üí verify not counted in today's total
   - Delete 1 task ‚Üí verify updates to "4 tasks due today"

2. **Time-of-Day Adaptive Progress:**
   - 9am: 0% complete ‚Üí verify green (on track at start of day)
   - 12pm: 25% complete ‚Üí verify green (on track)
   - 3pm: 20% complete ‚Üí verify yellow (expected 50%, behind)
   - 6pm: 40% complete ‚Üí verify red (expected 100%, critical)
   - Complete all tasks at 10am ‚Üí verify green "Ahead of schedule"

3. **Circular Progress Visualization:**
   - Verify progress ring displays correct percentage
   - Verify color matches status: green/yellow/red
   - Verify center label shows "X/Y" completed/total
   - Test animation: reload page ‚Üí verify ring animates from 0% to actual
   - Test accessibility: screen reader announces percentage

4. **Deep Work Integration:**
   - Log 2h Deep Work session on "Full Stack AI"
   - Verify shows "2.0h / 6h target (33%)"
   - Verify last session: "Last: 2.0h on Full Stack AI (just now)"
   - Wait 30 minutes ‚Üí verify "30 minutes ago"
   - Log another 3h ‚Üí verify total updates to "5.0h / 6h"
   - Reach 6h target ‚Üí verify green checkmark "Daily target reached"

5. **Overdue Tasks Indicator:**
   - Create 3 overdue tasks (due_date < TODAY)
   - Verify red badge "3 overdue" in top-right corner
   - Verify pulsing animation on badge
   - Click badge ‚Üí verify navigates to /daily with overdue filter
   - Complete 1 overdue task ‚Üí verify updates to "2 overdue"
   - Complete all overdue ‚Üí verify badge disappears

6. **Due Tomorrow Preview:**
   - Create 5 tasks due tomorrow (due_date = TODAY + 1)
   - Verify shows "5 tasks due tomorrow" in purple box
   - Create 12 tasks due tomorrow ‚Üí verify warning "‚ö†Ô∏è" appears
   - Click preview ‚Üí verify navigates to /daily with tomorrow filter
   - Delete tasks due tomorrow ‚Üí verify count updates

7. **Next Scheduled Event:**
   - Create schedule event at 2:00 PM today (future time)
   - Verify shows "Next: Client call at 2:00 PM (in X hours)"
   - Time passes to 1:45 PM ‚Üí verify shows "(in 15 minutes)" in yellow
   - Time passes to 1:55 PM ‚Üí verify shows "(in 5 minutes)" in red
   - Event time passes ‚Üí next event appears or "No events scheduled"
   - No events remaining ‚Üí verify shows "No events scheduled"

8. **Plan Today Button:**
   - Click "Plan Today" button ‚Üí verify navigates to /daily page
   - Verify button has Calendar icon
   - Verify hover effect: background darkens
   - Press keyboard shortcut "P" ‚Üí verify same navigation
   - Verify button click doesn't trigger card onClick (event.stopPropagation)

9. **Real-Time Updates:**
   - Open Review Dashboard in Tab 1 and Tab 2
   - Complete task in Daily page (Tab 1)
   - Verify Daily card completion % updates in Tab 2 within 500ms
   - Log Deep Work session in Tab 1
   - Verify Deep Work hours update in Tab 2 immediately
   - Create overdue task in Tab 1
   - Verify overdue badge appears in Tab 2

10. **Edge Cases and Empty States:**
    - No tasks due today ‚Üí verify shows "0 tasks due today" gracefully
    - No Deep Work logged ‚Üí verify "No deep work logged today ‚ö†Ô∏è"
    - No overdue tasks ‚Üí verify no badge displayed
    - No tasks due tomorrow ‚Üí verify section hidden or shows "0"
    - 100% complete at 8am ‚Üí verify "Ahead of schedule" green status
    - Weekend: verify expected progress curve adjusted for non-workday

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | v1.0 | Initial story creation for Daily Area Summary Card | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
_To be populated by development agent_

### Debug Log References
_To be populated by development agent_

### Completion Notes List
_To be populated by development agent_

### File List
_To be populated by development agent_

## QA Results
_To be populated by QA agent_
