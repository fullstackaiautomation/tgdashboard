# Story 1.9: Value Rating Filtering and Sorting

**Epic**: AI-Powered Content Library Enhancement
**Story ID**: 1.9
**Priority**: Low
**Estimated Effort**: Small (2-3 hours)

---

## User Story

**As a** user managing a large content library,
**I want** to filter and sort by value rating,
**so that** I can quickly find my highest-rated content worth revisiting.

---

## Acceptance Criteria

1. ✅ Add "Value Rating" filter section with range selector (e.g., "8+", "5-7", "1-4")
2. ✅ Add "Sort by Rating" option to existing sort dropdown
3. ✅ Sort by rating shows highest-rated first (DESC order)
4. ✅ Filter by rating excludes unrated content when range selected
5. ✅ Option to filter "Rated Only" vs "Include Unrated"
6. ✅ Rating filter works with other active filters
7. ✅ Clear visual feedback for active rating filters

---

## Integration Verification

**IV1**: Rating filter queries use indexed value_rating column for performance
**IV2**: Rating filter/sort doesn't break when content lacks rating (null handling)
**IV3**: Combined filters (rating + area + status) execute efficiently (<500ms)

---

## Implementation Notes

### Add Filter Section
```tsx
<div>
  <label className="block text-sm font-medium text-gray-300 mb-2">Value Rating</label>
  <div className="space-y-2">
    <label className="flex items-center gap-2">
      <input
        type="radio"
        name="ratingFilter"
        checked={filters.ratingRange === 'all'}
        onChange={() => setFilters({ ...filters, ratingRange: 'all' })}
      />
      <span className="text-sm text-gray-300">All Ratings</span>
    </label>
    <label className="flex items-center gap-2">
      <input
        type="radio"
        name="ratingFilter"
        checked={filters.ratingRange === '8+'}
        onChange={() => setFilters({ ...filters, ratingRange: '8+' })}
      />
      <span className="text-sm text-gray-300">⭐ 8+ (High Value)</span>
    </label>
    <label className="flex items-center gap-2">
      <input
        type="radio"
        name="ratingFilter"
        checked={filters.ratingRange === '5-7'}
        onChange={() => setFilters({ ...filters, ratingRange: '5-7' })}
      />
      <span className="text-sm text-gray-300">⭐ 5-7 (Medium Value)</span>
    </label>
    <label className="flex items-center gap-2">
      <input
        type="radio"
        name="ratingFilter"
        checked={filters.ratingRange === '1-4'}
        onChange={() => setFilters({ ...filters, ratingRange: '1-4' })}
      />
      <span className="text-sm text-gray-300">⭐ 1-4 (Low Value)</span>
    </label>
    <label className="flex items-center gap-2">
      <input
        type="radio"
        name="ratingFilter"
        checked={filters.ratingRange === 'unrated'}
        onChange={() => setFilters({ ...filters, ratingRange: 'unrated' })}
      />
      <span className="text-sm text-gray-300">Unrated Only</span>
    </label>
  </div>
</div>
```

### Sort Option
```tsx
<select value={sortBy} onChange={(e) => setSortBy(e.target.value)}>
  <option value="saved_at">Sort by Date</option>
  <option value="priority">Sort by Priority</option>
  <option value="title">Sort by Title</option>
  <option value="status">Sort by Status</option>
  <option value="rating">Sort by Rating</option>
</select>
```

### Filter Logic
```typescript
// Rating filter
if (filters.ratingRange && filters.ratingRange !== 'all') {
  if (filters.ratingRange === '8+') {
    filtered = filtered.filter(item => item.value_rating && item.value_rating >= 8)
  } else if (filters.ratingRange === '5-7') {
    filtered = filtered.filter(item => item.value_rating && item.value_rating >= 5 && item.value_rating <= 7)
  } else if (filters.ratingRange === '1-4') {
    filtered = filtered.filter(item => item.value_rating && item.value_rating >= 1 && item.value_rating <= 4)
  } else if (filters.ratingRange === 'unrated') {
    filtered = filtered.filter(item => !item.value_rating)
  }
}

// Rating sort
if (sortBy === 'rating') {
  filtered.sort((a, b) => {
    const ratingA = a.value_rating || 0
    const ratingB = b.value_rating || 0
    return sortOrder === 'desc' ? ratingB - ratingA : ratingA - ratingB
  })
}
```

---

## Files to Modify

- `src/components/ContentLibrary.tsx` (filter panel, sort dropdown, applyFilters function)
- `src/types/content.ts` (add ratingRange to ContentFilter interface)

---

## Definition of Done

- [ ] Rating filter section added
- [ ] Sort by rating option added
- [ ] Filter logic handles all rating ranges
- [ ] Unrated filter works correctly
- [ ] Sort shows highest ratings first
- [ ] Null ratings handled gracefully
- [ ] Combined filters perform well
- [ ] All integration verification tests pass

---

**Story Status**: Ready for Development (depends on Story 1.2)
**Assigned To**: TBD
