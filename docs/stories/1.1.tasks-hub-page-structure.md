# Story 1.1: Tasks Hub Page Structure & Data Model

## Status
Ready for Review

## Story
**As a** multi-business operator,
**I want** a centralized Tasks page that displays all tasks from every business and life area in a unified view,
**so that** I can see everything I need to do across my entire ecosystem without navigating to individual pages.

## Acceptance Criteria
1. Tasks page displays all tasks from Business areas (Full Stack AI, Service SaaS, Huge Capital, S4, 808), Daily planning, and Health/Life areas in a single unified list
2. Each task card shows: task title, source area/business (color-coded), due date, status (active/completed/overdue), and Project > Phase hierarchy if applicable
3. Tasks can be filtered by business area using the existing color-coded filter buttons (matching Daily page pattern)
4. Tasks can be filtered by status: Active, Completed, Recurring, Overdue
5. Tasks support inline editing: click to edit title, change due date, update status without leaving Tasks page
6. Database schema includes `tasks` table with foreign keys to `projects`, `phases`, `businesses`, and `life_areas` tables
7. Tasks page loads in <2 seconds with 100+ tasks displayed
8. Color coding matches existing dashboard palette (green=Full Stack, purple=Huge Capital, blue=S4, orange=808, pink=Personal, teal=Health, orange=Golf)

## Tasks / Subtasks
- [x] Task 1: Design and implement database schema for Tasks hub (AC: 6)
  - [x] Create `businesses` table with id, name, color, slug fields
  - [x] Create `projects` table with id, name, business_id (FK), description, status
  - [x] Create `phases` table with id, name, project_id (FK), description, status
  - [x] Create `life_areas` table with id, name, color, category fields
  - [x] Create `tasks` table with all required fields from existing Task interface plus business_id, project_id, phase_id, life_area_id (nullable FKs)
  - [x] Add RLS policies on all tables (user_id = auth.uid())
  - [x] Create database indexes on business_id, due_date, status, user_id columns
  - [x] Run migration script to create tables in Supabase
- [x] Task 2: Create TypeScript types for database entities (AC: 6)
  - [x] Generate Supabase types using `npx supabase gen types typescript`
  - [x] Create src/types/business.ts with Business interface
  - [x] Create src/types/project.ts with Project and Phase interfaces
  - [x] Update src/types/task.ts to include business, project, phase relations
  - [x] Create src/types/life-area.ts with LifeArea interface
- [x] Task 3: Build Tasks Hub page component structure (AC: 1, 2)
  - [x] Create src/components/tasks/ directory
  - [x] Create src/components/tasks/TasksHub.tsx main page component
  - [x] Create src/components/tasks/TaskCard.tsx for individual task display
  - [x] Create src/components/tasks/TaskFilters.tsx for business/status filters
  - [x] Add route to App.tsx for /tasks path
  - [x] Add "Tasks" link to Sidebar navigation
- [x] Task 4: Implement task data fetching with React Query (AC: 1, 7)
  - [x] Create src/hooks/useTasks.ts hook
  - [x] Implement query to fetch all tasks with joined businesses, projects, phases data
  - [x] Add loading state with skeleton UI
  - [x] Add error state with error message display
  - [x] Optimize query with proper select joins for <2 second load time
- [x] Task 5: Implement task card display with all required fields (AC: 2, 8)
  - [x] Display task title with completion checkbox
  - [x] Show source area/business with color-coded badge using CSS variables
  - [x] Display due date with formatting
  - [x] Show status indicator (active/completed/overdue)
  - [x] Display Project > Phase hierarchy when applicable
  - [x] Apply color coding: green=Full Stack, purple=Huge Capital, blue=S4, orange=808, pink=Personal, teal=Health
- [x] Task 6: Build filter functionality (AC: 3, 4)
  - [x] Create filter buttons for each business area (Full Stack, Service SaaS, Huge Capital, S4, 808, Health, Personal, Golf)
  - [x] Create status filter buttons (Active, Completed, Recurring, Overdue)
  - [x] Implement filter logic to show/hide tasks based on selected filters
  - [x] Style filter buttons matching Daily page pattern
  - [x] Add "All" filter option to clear filters
- [x] Task 7: Implement inline task editing (AC: 5)
  - [x] Add click-to-edit for task title
  - [x] Add date picker for due date inline editing
  - [x] Add status dropdown for status changes
  - [x] Create useMutation hook for task updates
  - [x] Implement optimistic updates for immediate UI feedback
  - [x] Add error handling and rollback on failed updates
- [x] Task 8: Add CSS theme variables for business colors (AC: 8)
  - [x] Add business color variables to src/styles/theme.css
  - [x] Define --color-business-fullstack: #10b981 (green)
  - [x] Define --color-business-hugecapital: #a855f7 (purple)
  - [x] Define --color-business-s4: #3b82f6 (blue)
  - [x] Define --color-business-808: #f97316 (orange)
  - [x] Define --color-area-personal: #ec4899 (pink)
  - [x] Define --color-area-health: #14b8a6 (teal)

## Dev Notes

### Previous Story Insights
No previous stories exist. This is Story 1.1 - the first story in the project.

### Architecture Context

**Tech Stack:** [Source: docs/ui-architecture.md#2-frontend-tech-stack]
- Frontend: React 19.1.1 + TypeScript 5.9.3
- Build Tool: Vite 7.1.7
- Styling: Tailwind CSS 3.4.1 with CSS custom properties
- State Management: TanStack Query (React Query) 5.90.2
- Backend: Supabase (PostgreSQL + Auth + Real-time)
- Icons: Lucide React 0.544.0
- Date Handling: date-fns 4.1.0

**Project Structure:** [Source: docs/ui-architecture.md#3-project-structure]
- Components organized by feature: src/components/tasks/ for Tasks hub components
- Custom hooks in src/hooks/ (useTasks.ts for task CRUD operations)
- TypeScript types in src/types/ as .ts files (NOT .tsx)
- Global styles in src/styles/ with theme.css for CSS custom properties
- Supabase client configured in src/lib/supabase.ts

**Existing Components:** [Current codebase analysis]
- src/components/TodoList.tsx - Daily todo list (reference for task display patterns)
- src/components/Sidebar.tsx - Navigation sidebar (add Tasks link here)
- src/types/task.tsx - Existing Task interface (needs extension for relationships)
- src/lib/supabase.ts - Supabase client already configured

**Component Standards:** [Source: docs/ui-architecture.md#4-component-standards]
- Use FC (FunctionComponent) type for components
- Always handle loading and error states with early returns
- Use React Query (useQuery, useMutation) for data fetching
- Component naming: PascalCase (TaskCard.tsx exports TaskCard)
- Hook naming: camelCase with 'use' prefix (useTasks)
- Props interfaces: PascalCase with 'Props' suffix (TaskCardProps)

**State Management Pattern:** [Source: docs/ui-architecture.md#5-state-management]
- React Query for server state (tasks, projects, businesses)
- useQuery for data fetching with queryKey: ['tasks'] or ['tasks', businessId]
- useMutation for updates with optimistic updates pattern
- Always include onMutate for optimistic updates, onError for rollback, onSettled for cache invalidation

**Supabase Patterns:** [Source: docs/ui-architecture.md#6-api-integration]
- Fetch with relations: `.select('*, businesses(name, color), projects(name), phases(name)')`
- Always check errors: `if (error) throw error`
- Use parameterized queries: `.eq('business_id', businessId)`
- RLS policies required on all tables: `auth.uid() = user_id`

**Styling Guidelines:** [Source: docs/ui-architecture.md#8-styling-guidelines]
- Tailwind utility classes for component styling
- CSS custom properties for theme colors (business colors, progress colors)
- Dark mode colors: bg-gray-800 (cards), text-gray-100 (primary text), text-gray-400 (secondary text)
- Card pattern: `bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-colors`
- Progress colors: <33% red-500, 33-66% yellow-500, 67-100% green-500

**Database Schema Requirements:** [Source: Epic 1.1 AC #6]
- Create tables: businesses, projects, phases, life_areas, tasks
- Foreign keys: tasks.business_id → businesses.id, tasks.project_id → projects.id, tasks.phase_id → phases.id, tasks.life_area_id → life_areas.id
- All FKs nullable (tasks can be business tasks OR life area tasks, not both)
- Add indexes on: business_id, due_date, status, user_id for <100ms query response
- Enable RLS on all tables with user_id = auth.uid() policy

**Performance Requirements:** [Source: Epic 1.1 AC #7]
- Page load <2 seconds with 100+ tasks
- Use React Query caching (staleTime: 5 minutes)
- Optimize Supabase queries with proper select joins
- Consider virtual scrolling for 50+ tasks (not required for MVP)

**Business Color Coding:** [Source: Epic 1.1 AC #8 + docs/ui-architecture.md#8-styling-guidelines]
- Full Stack AI: green (#10b981)
- Huge Capital: purple (#a855f7)
- S4: blue (#3b82f6)
- 808: orange (#f97316)
- Personal: pink (#ec4899)
- Health: teal (#14b8a6)
- Golf: orange-red (#f97316)

**Security Rules:** [Source: docs/ui-architecture.md#11-frontend-developer-standards]
- NEVER expose secrets in client code
- ONLY use VITE_SUPABASE_ANON_KEY (protected by RLS)
- NEVER skip RLS policies - every table must have RLS enabled
- Validate all user input before submission

**File Locations for This Story:**
- Database migration: Create SQL file in project root (e.g., supabase-tasks-schema.sql)
- Main page: src/components/tasks/TasksHub.tsx
- Task card: src/components/tasks/TaskCard.tsx
- Filters: src/components/tasks/TaskFilters.tsx
- Custom hook: src/hooks/useTasks.ts
- Types: src/types/business.ts, src/types/project.ts, update src/types/task.ts
- Theme: Update src/styles/theme.css (may need to create if doesn't exist)
- Route: Add to src/App.tsx

### Testing

**Testing Strategy:** [Source: docs/ui-architecture.md#9-testing-requirements]
Manual testing with convenience methods (no automated test suite per PRD requirements)

**Manual Testing Workflow:**
1. Feature Testing: Execute feature → Verify across affected pages → Check console for errors
2. Data Integrity: CRUD operations → Verify with browser DevTools → Check for orphaned records
3. Performance: Seed 100+ tasks → Measure page load (<2s) → Monitor React Query cache
4. Security: Verify RLS policies → Check for exposed secrets → Inspect network tab for proper auth headers

**Test Helpers to Create:** [Source: docs/ui-architecture.md#9-testing-requirements]
- Create src/utils/testHelpers.ts with seedTestData() and debugState() functions
- Expose via window.__test in development mode for browser console access
- Usage: `__test.seedData()` to create test tasks, `__test.debug()` to inspect state

**Testing Requirements for This Story:**
1. Verify all 8 acceptance criteria manually
2. Test with empty state (no tasks)
3. Test with 100+ tasks for performance
4. Test filtering by each business area
5. Test filtering by each status type
6. Test inline editing (title, due date, status)
7. Verify color coding for all business areas
8. Check console for errors during all operations
9. Verify RLS policies prevent access to other users' tasks
10. Measure page load time with developer tools (must be <2 seconds)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | v1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
_To be populated by development agent_

### Completion Notes List
- All 8 tasks completed successfully
- Database schema created with 5 tables (businesses, projects, phases, life_areas, tasks)
- TypeScript types created with TaskHub interface for new schema (Task interface preserved for backward compatibility)
- Full Tasks Hub page with data fetching, filtering, and inline editing implemented
- Build successful with no errors
- All acceptance criteria met

### File List
- Created: supabase-tasks-hub-schema.sql
- Created: src/types/business.ts
- Created: src/types/project.ts
- Created: src/types/life-area.ts
- Modified: src/types/task.ts (added TaskHub interface, kept Task for backward compatibility)
- Created: src/hooks/useTasks.ts
- Created: src/styles/theme.css
- Created: src/components/tasks/TasksHub.tsx
- Created: src/components/tasks/TaskCard.tsx
- Created: src/components/tasks/TaskFilters.tsx
- Modified: src/App.tsx (added Tasks tab and route)
- Modified: src/components/Sidebar.tsx (added Tasks Hub link)
- Modified: src/main.tsx (imported theme.css)

## QA Results
_To be populated by QA agent_
