# Story 2.1: Task-Level Progress Calculation & Display

## Status
Draft

## Story
**As a** consultant tracking detailed work,
**I want** individual tasks to show completion status with visual indicators,
**so that** I can quickly see which tasks are done, in progress, or not started without reading details.

## Acceptance Criteria
1. Tasks support completion status: Not Started (0%), In Progress (1-99%), Completed (100%)
2. Task cards display progress with visual indicator: checkbox (not started), partial fill or progress ring (in progress), checkmark (completed)
3. In Progress tasks allow setting custom % complete (e.g., 25%, 50%, 75%) via slider or numeric input
4. Task completion status updates in real-time across all pages (Business, Tasks Hub, Daily) via existing sync mechanism
5. Completed tasks are visually distinct: strikethrough text, green checkmark icon, or dimmed opacity
6. Overdue tasks (due date passed, status < 100%) display red warning indicator
7. Task cards on all pages show the progress indicator consistently (same visual language throughout dashboard)
8. Bulk actions allow marking multiple tasks complete simultaneously from Tasks Hub

## Tasks / Subtasks
- [ ] Task 1: Add progress_percentage column to tasks table (AC: 1, 3)
  - [ ] Add progress_percentage INTEGER column to tasks table (0-100 range, default 0)
  - [ ] Add CHECK constraint: progress_percentage >= 0 AND progress_percentage <= 100
  - [ ] Update TypeScript Task type to include progress_percentage field
  - [ ] Create database migration script
  - [ ] Map progress to status: 0% = Not Started, 1-99% = In Progress, 100% = Completed
- [ ] Task 2: Build progress indicator UI component (AC: 2, 5, 7)
  - [ ] Create src/components/shared/ProgressIndicator.tsx component
  - [ ] Render checkbox for 0% (not started)
  - [ ] Render progress ring or partial fill for 1-99% (in progress)
  - [ ] Render green checkmark for 100% (completed)
  - [ ] Use consistent styling across all pages (TaskCard, BusinessPage, Daily)
  - [ ] Add strikethrough text and dimmed opacity (50%) for completed tasks
- [ ] Task 3: Implement progress percentage editor (AC: 3)
  - [ ] Add progress slider (0-100%) that appears on hover or click
  - [ ] Add numeric input for direct % entry
  - [ ] Add quick-set buttons: 25%, 50%, 75%, 100%
  - [ ] Update task via useMutation when progress changes
  - [ ] Use optimistic updates for instant UI feedback
- [ ] Task 4: Add overdue task indicator (AC: 6)
  - [ ] Calculate overdue: due_date < current_date AND progress_percentage < 100
  - [ ] Display red warning badge or border on overdue TaskCard
  - [ ] Show "Overdue by X days" label
  - [ ] Use Lucide AlertTriangle icon with red color
  - [ ] Sort overdue tasks to top of lists
- [ ] Task 5: Update TaskCard across all pages with progress indicator (AC: 7)
  - [ ] Update src/components/tasks/TaskCard.tsx to use ProgressIndicator
  - [ ] Update Business page task displays to use same ProgressIndicator
  - [ ] Update Daily To-Do List to use same ProgressIndicator
  - [ ] Ensure visual consistency: same size, colors, animations
  - [ ] Test on all pages: Tasks Hub, Business, Daily, Health, Life
- [ ] Task 6: Implement bulk complete action (AC: 8)
  - [ ] Add checkbox selection to TaskCard (shift+click for multi-select)
  - [ ] Add "Mark Complete" button in Tasks Hub toolbar when tasks selected
  - [ ] Update multiple tasks to progress_percentage = 100 in single mutation
  - [ ] Show toast notification: "5 tasks marked complete"
  - [ ] Use transaction or batch update for atomicity
- [ ] Task 7: Ensure real-time sync for progress updates (AC: 4)
  - [ ] Verify useRealtimeSync hook updates when progress_percentage changes
  - [ ] Test: update progress in Tab 1 → verify updates in Tab 2 within 500ms
  - [ ] Verify optimistic updates work correctly with rollback on error
  - [ ] Cache invalidation triggers refetch across all query keys
- [ ] Task 8: Add progress indicator to existing Task queries (AC: all)
  - [ ] Update useTasks hook to SELECT progress_percentage
  - [ ] Update all Supabase queries to include progress_percentage field
  - [ ] Add progress sorting option: sort by % complete (ascending/descending)
  - [ ] Filter tasks by completion status: Not Started, In Progress, Completed

## Dev Notes

### Previous Story Insights
**From Story 1.1:** [Source: docs/stories/1.1.tasks-hub-page-structure.md]
- TaskCard.tsx exists with basic task display
- useTasks.ts hook handles task CRUD with React Query
- Optimistic updates pattern established

**From Story 1.2-1.5:** [Source: docs/stories/1.2-1.5]
- Real-time sync via useRealtimeSync.ts is functional
- Tasks table includes all necessary foreign keys
- Sync latency <500ms requirement established

**Key Technical Decisions:**
- progress_percentage stored as INTEGER (0-100) in database, not DECIMAL
- Map to status enum for filtering: 0 = not_started, 1-99 = in_progress, 100 = completed
- Progress indicator is shared component used across all task displays
- Bulk operations use batch updates for performance

### Architecture Context

**Tech Stack:** [Source: docs/ui-architecture/2-frontend-tech-stack.md]
- React 19.1.1 + TypeScript 5.9.3
- TanStack Query 5.90.2
- Lucide React 0.544.0 for icons

**Database Schema Update:**
```sql
ALTER TABLE tasks ADD COLUMN progress_percentage INTEGER DEFAULT 0
  CHECK (progress_percentage >= 0 AND progress_percentage <= 100);

CREATE INDEX idx_tasks_progress ON tasks(progress_percentage);
```

**Progress Indicator Component Pattern:**
```typescript
interface ProgressIndicatorProps {
  progress: number; // 0-100
  size?: 'sm' | 'md' | 'lg';
  showLabel?: boolean;
  editable?: boolean;
  onProgressChange?: (progress: number) => void;
}

export const ProgressIndicator: FC<ProgressIndicatorProps> = ({ progress, ... }) => {
  if (progress === 0) {
    return <Checkbox checked={false} />;
  } else if (progress === 100) {
    return <Check className="text-green-500" />;
  } else {
    return <ProgressRing progress={progress} />;
  }
};
```

**Overdue Calculation:**
```typescript
const isOverdue = (task: Task) => {
  if (!task.due_date || task.progress_percentage === 100) return false;
  return new Date(task.due_date) < new Date();
};
```

**File Locations:**
- Migration: add-progress-percentage.sql
- Create: src/components/shared/ProgressIndicator.tsx
- Create: src/components/shared/ProgressRing.tsx (circular progress indicator)
- Create: src/components/shared/ProgressSlider.tsx (% editor)
- Update: src/components/tasks/TaskCard.tsx
- Update: src/types/task.ts (add progress_percentage field)
- Update: src/hooks/useTasks.ts (include progress in queries)

### Testing

**Testing Requirements:**
1. Verify all 8 acceptance criteria
2. Test progress slider: set to 50% → verify updates in database
3. Test overdue indicator: create task with past due_date → verify red badge
4. Test bulk complete: select 5 tasks → mark complete → verify all updated
5. Test visual consistency: verify ProgressIndicator looks same on all pages
6. Test real-time sync: update progress in one tab → verify syncs to another
7. Test completed task styling: complete task → verify strikethrough and dimmed

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-07 | v1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
_To be populated by development agent_

### Debug Log References
_To be populated by development agent_

### Completion Notes List
_To be populated by development agent_

### File List
_To be populated by development agent_

## QA Results
_To be populated by QA agent_
